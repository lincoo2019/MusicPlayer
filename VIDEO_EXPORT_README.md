# 🎵 滚动歌词视频导出功能

## 功能概述

本项目在原有的Apple Music风格滚动歌词播放器基础上，新增了**音频+滚动歌词→视频导出**功能，可以将音频文件和对应的LRC歌词文件转换为包含滚动歌词效果的视频文件。

## 🆕 新增功能

### 视频导出特性
- ✅ **Canvas渲染**：使用Canvas API实时绘制视频内容
- ✅ **高质量输出**：1920x1080分辨率，30fps帧率
- ✅ **音频同步**：确保音频与歌词完美同步
- ✅ **视觉效果**：
  - 动态渐变背景（从封面图片提取颜色）
  - 圆角专辑封面显示
  - 滚动歌词动画（模糊、缩放、透明度效果）
  - 播放进度条和时间显示
- ✅ **格式支持**：WebM格式（VP9视频+Opus音频）
- ✅ **自动下载**：导出完成后自动触发下载

## 🚀 使用方法

### 1. 启动服务器
```bash
# 在项目目录中启动HTTP服务器
python3 -m http.server 8000
# 或使用其他HTTP服务器
```

### 2. 打开应用
访问 `http://localhost:8000` 或 `http://localhost:8000/test.html`

### 3. 导入文件
1. 点击左侧音乐图标
2. 选择音频文件（MP3、WAV、OGG等）
3. 选择封面图片（可选，JPG、PNG等）
4. 选择LRC歌词文件（必需）

### 4. 导出视频
1. 确认音频和歌词同步正常
2. 点击右侧的导出视频按钮（向下箭头图标）
3. 等待导出完成
4. 视频文件会自动下载（文件名：`[歌曲名].webm`）

## 📋 技术要求

### 浏览器支持
- ✅ Chrome 60+
- ✅ Firefox 55+
- ✅ Safari 14+
- ✅ Edge 79+

### 必需API支持
- Canvas API
- MediaRecorder API
- Web Audio API
- MediaStream API
- File API

### 环境要求
- **必须**使用HTTPS或localhost（MediaRecorder API要求）
- 推荐使用现代浏览器以获得最佳体验

## 🎯 输出格式

- **视频编码**：VP9
- **音频编码**：Opus
- **容器格式**：WebM
- **分辨率**：1920×1080
- **帧率**：30fps
- **码率**：5Mbps（视频）

## 📁 文件格式要求

### 音频文件
- 支持所有HTML5音频格式
- 推荐：MP3（最佳兼容性）

### 歌词文件
- 格式：LRC（标准时间戳格式）
- 编码：自动检测UTF-8、GBK、Big5、Shift_JIS
- 示例格式：
  ```
  [00:12.34]第一行歌词
  [00:56.78]第二行歌词
  ```

### 封面图片
- 支持所有HTML5图片格式
- 推荐尺寸：正方形（如512×512）
- 用于背景颜色提取和视频封面显示

## 🔧 实现原理

### 核心技术栈
1. **Canvas 2D API** - 绘制视频帧
2. **MediaRecorder API** - 录制视频流
3. **Web Audio API** - 处理音频流
4. **MediaStream API** - 合并音视频流

### 渲染流程
1. 创建离屏Canvas用于绘制
2. 实时绘制背景、封面、歌词、进度条
3. 通过Canvas.captureStream()获取视频流
4. 通过Web Audio API处理音频流
5. 合并音视频流并使用MediaRecorder录制
6. 生成Blob文件并触发下载

### 歌词动画
- 当前歌词：完全不透明、无模糊、原始大小
- 附近歌词：渐变透明度、模糊效果、缩放效果
- 远离歌词：高度透明、强模糊、小尺寸

## 🐛 常见问题

### Q: 无法导出视频？
A: 检查以下几点：
1. 确保使用HTTPS或localhost
2. 检查浏览器是否支持所需API
3. 确保已加载音频和歌词文件
4. 查看浏览器控制台错误信息

### Q: 视频质量不佳？
A: 可以调整以下参数：
- 修改`videoBitsPerSecond`提高码率
- 调整`canvas.width/height`改变分辨率
- 修改字体大小和渲染效果

### Q: 音频和歌词不同步？
A: 确保：
1. LRC文件时间戳准确
2. 音频文件完整无损坏
3. 浏览器性能充足

## 📄 许可证

本功能基于原有的开源项目开发，遵循相同的开源许可证。